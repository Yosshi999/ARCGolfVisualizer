R=range
def p(g):
 W=len(g[0]);A=len(G:=sum(g,[]));L=[-~i*G[i] for i in R(A)]
 for x in R(A):L=[{L[x+(-~x%W!=0<G[x+1]==G[x])]:L[x],L[x+W*(A>x+W>0<G[x+W]==G[x])]:L[x]}.get(_,_)for _ in L]
 n=len(set(L))-1;return [[8*(y==x)for x in R(n)]for y in R(n)]