p=lambda g,d=8,s=0:d and p([*zip(*[([h]+v,[h,*[0]*(s:=s+(h==2)),*g[0][1:len(g[0])-s]])[{*g[0],2}>{max(g)[0],0}=={*g[1],2}]for h,*v in g])][::1-2*(d%4>0)],d-1)or g