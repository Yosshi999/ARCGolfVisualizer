e=enumerate
def f(g):
 i=g.index(V:=max(g))
 if len({*V})>2:m,M=[j for j,w in e(V)if w];C=m+M>>1;g=[[V[(m,M)[x>C]]*((m<=x<=M>i==y)|(-3<y-i<3>x-C>-2)>(-2<y-i<2>x-C>-1))for x,c in e(v)]for y,v in e(g)]
 return[*zip(*g)]
p=lambda g:f(f(g))