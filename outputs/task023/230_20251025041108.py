def p(g,i=0):
 L=len(G:=sum(g,[]))
 def f(y,*v):
  a=1;o=[*map(list,g)]
  for k in v:a&=G[j:=(i+k)%L];o[j//W][j%W]=y
  return p(a*o,i+1)
 return-~-(5in G)*g if L<i+2else f(8,0,1,W:=len(g[0]),W+1)or f(2,0,1,2)or f(2,0,W,W+W)or f(g)