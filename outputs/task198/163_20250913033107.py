f=lambda v:max(v,key=v.count)
p=lambda g,d=24:d and p([[(4*(a+1==b==4)or a,a or 4-(f(v)==f(w)<1))[d>20]for w,a,b in zip(g,v,[0]+v)]for*v,in zip(*g)][::-1],d-1)or g