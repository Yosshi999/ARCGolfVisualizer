<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>AnaRChy Golf</title>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet">
        <style>

        </style>
    </head>
    <body>
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand fw-bold" href="/">AnaRChy Golf</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link active" href="/">Problems</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/explorer">ðŸŽ¯ Explorer</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="col-md-10 main-content">
            <div id="page-content">
                <div id="problems-page" class="p-4">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <h2><a href="/download">ðŸ‘‰Download submission.zip</a></h2>
                            <h2>Problems</h2>
                            <h3>Current Estimated Score: {{ overall_score }}</h3>
                        </div>
                        <div>
                            <button id="sync-shortest-btn" class="btn btn-primary">
                                <span id="sync-btn-text">Sync shortest</span>
                                <span id="sync-spinner" class="spinner-border spinner-border-sm ms-2 d-none" role="status"></span>
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Task <a href="/?sort=name">â–¼</a></th>
                                    <th>Summary</th>
                                    <th>Hardness <a href="/?sort=hardness">â–¼</a></th>
                                    <th>Shortest <a href="/?sort=global_shortest">â–¼</a></th>
                                    <th>Size</th>
                                    <th>Score <a href="/?sort=score">â–¼</a></th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for task in tasks_info %}
                                <tr>
                                    <td>
                                        <a href="/problem/{{ task.name }}">{{ task.name }}</a>
                                    </td>
                                    <td> {{ task.summary }} </td>
                                    <td> {{ task.hardness }} </td>
                                    <td> {{ task.global_shortest }} bytes </td>
                                    <td>
                                        {% if task.exists %}
                                            {{ task.size }} bytes
                                        {% else %}
                                            N/A
                                        {% endif %}
                                    </td>
                                    <td>
                                        {{ task.score }}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
        <script>
        document.getElementById('sync-shortest-btn').addEventListener('click', function() {
            const btn = this;
            const btnText = document.getElementById('sync-btn-text');
            const spinner = document.getElementById('sync-spinner');
            
            btn.disabled = true;
            btnText.textContent = 'Syncing...';
            spinner.classList.remove('d-none');
            
            fetch('/sync_global_shortest', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(`Success! Synced ${data.count} task shortest data.`);
                    location.reload();
                } else {
                    alert('Error: ' + data.error);
                }
            })
            .catch(error => {
                alert('Error: ' + error.message);
            })
            .finally(() => {
                btn.disabled = false;
                btnText.textContent = 'Sync shortest';
                spinner.classList.add('d-none');
            });
        });
        </script>
    </body>
</html>